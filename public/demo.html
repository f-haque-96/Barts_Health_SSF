<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Contract Drafter Stage Demo - NHS Supplier Form</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #005EB8 0%, #003087 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .container {
      background: white;
      border-radius: 16px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      max-width: 800px;
      width: 100%;
      padding: 40px;
    }

    h1 {
      color: #005EB8;
      margin-bottom: 10px;
      font-size: 28px;
    }

    .subtitle {
      color: #6b7280;
      margin-bottom: 30px;
      font-size: 14px;
    }

    .section {
      margin-bottom: 30px;
    }

    .section h2 {
      color: #1f2937;
      font-size: 18px;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .icon {
      font-size: 24px;
    }

    .info-box {
      background: #f0f7ff;
      border: 1px solid #dbeafe;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
    }

    .info-box h3 {
      color: #005EB8;
      font-size: 14px;
      margin-bottom: 10px;
      font-weight: 600;
    }

    .info-box ul {
      list-style: none;
      padding-left: 0;
    }

    .info-box li {
      padding: 6px 0;
      color: #374151;
      font-size: 14px;
    }

    .info-box li strong {
      color: #1f2937;
      font-weight: 600;
      display: inline-block;
      min-width: 140px;
    }

    button {
      background: #005EB8;
      color: white;
      border: none;
      border-radius: 8px;
      padding: 14px 28px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      width: 100%;
      margin-bottom: 10px;
    }

    button:hover {
      background: #003087;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 94, 184, 0.3);
    }

    button:active {
      transform: translateY(0);
    }

    button.secondary {
      background: #059669;
    }

    button.secondary:hover {
      background: #047857;
    }

    button.danger {
      background: #ef4444;
    }

    button.danger:hover {
      background: #dc2626;
    }

    .success-message, .error-message {
      padding: 16px;
      border-radius: 8px;
      margin-bottom: 20px;
      font-size: 14px;
      display: none;
    }

    .success-message {
      background: #f0fdf4;
      border: 1px solid #bbf7d0;
      color: #166534;
    }

    .error-message {
      background: #fef2f2;
      border: 1px solid #fecaca;
      color: #991b1b;
    }

    .success-message.show, .error-message.show {
      display: block;
    }

    .links {
      display: flex;
      gap: 10px;
      margin-top: 20px;
    }

    .links a {
      flex: 1;
      text-align: center;
      padding: 12px;
      background: #f3f4f6;
      border: 2px solid #e5e7eb;
      border-radius: 8px;
      text-decoration: none;
      color: #005EB8;
      font-weight: 600;
      font-size: 14px;
      transition: all 0.2s;
    }

    .links a:hover {
      background: #005EB8;
      color: white;
      border-color: #005EB8;
    }

    .status {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
      background: #fef3c7;
      color: #92400e;
      margin-left: 10px;
    }

    .status.ready {
      background: #d1fae5;
      color: #065f46;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üìã Contract Drafter Stage Demo</h1>
    <p class="subtitle">Test the contract negotiation workflow without submitting a full form</p>

    <div id="successMessage" class="success-message"></div>
    <div id="errorMessage" class="error-message"></div>

    <div class="section">
      <h2><span class="icon">üéØ</span> Quick Start</h2>
      <button onclick="createDemo()">Create Demo Data</button>
      <p style="color: #6b7280; font-size: 14px; margin-top: 10px; text-align: center;">
        This will create a mock submission in the Contract Drafter stage
      </p>
    </div>

    <div class="section">
      <h2><span class="icon">üìä</span> Demo Scenario</h2>
      <div class="info-box">
        <h3>Submission Details:</h3>
        <ul>
          <li><strong>Submission ID:</strong> DEMO-CONTRACT-2024-001</li>
          <li><strong>Supplier:</strong> Elite Consulting Ltd</li>
          <li><strong>Contact:</strong> John Smith (john.smith@eliteconsulting.com)</li>
          <li><strong>Requester:</strong> Sarah Johnson (sarah.johnson@nhs.net)</li>
          <li><strong>IR35 Status:</strong> Outside IR35 (Consultancy Agreement)</li>
          <li><strong>Current Stage:</strong> Contract Drafter</li>
        </ul>
      </div>

      <div class="info-box">
        <h3>Exchange Thread (3 messages):</h3>
        <ul>
          <li><strong>Message 1:</strong> Contract Drafter sends Barts Consultancy Agreement with instructions</li>
          <li><strong>Message 2:</strong> Supplier asks question about IP rights and daily rate</li>
          <li><strong>Message 3:</strong> Contract Drafter clarifies IP clause and confirms rate</li>
        </ul>
      </div>
    </div>

    <div class="section">
      <h2><span class="icon">üîó</span> Access Demo Pages <span class="status" id="demoStatus">Not Created</span></h2>
      <div class="links" id="demoLinks" style="display: none;">
        <a id="contractDrafterLink" href="#" target="_blank">
          üëî Contract Drafter View
        </a>
        <a id="responseLink" href="#" target="_blank">
          üìù Requester/Supplier View
        </a>
      </div>
      <p style="color: #6b7280; font-size: 13px; margin-top: 15px; padding: 12px; background: #fef9c3; border-radius: 6px; border: 1px solid #fde047;">
        <strong>‚ö†Ô∏è Note:</strong> You may need to bypass authentication or log in with appropriate role (Contract Drafter or Admin) to view these pages in development.
      </p>
    </div>

    <div class="section">
      <h2><span class="icon">üß™</span> What You Can Test</h2>
      <div class="info-box">
        <h3>Contract Drafter View (/contract-drafter/:id):</h3>
        <ul>
          <li>‚úì View submission summary and IR35 status</li>
          <li>‚úì See pre-selected agreement template</li>
          <li>‚úì Review exchange thread with color-coded messages</li>
          <li>‚úì Send follow-up messages to supplier</li>
          <li>‚úì Approve contract (routes to AP Control)</li>
          <li>‚úì Request changes (sends back to supplier)</li>
        </ul>
      </div>

      <div class="info-box">
        <h3>Requester/Supplier View (/respond/:id):</h3>
        <ul>
          <li>‚úì View exchange thread as requester or supplier</li>
          <li>‚úì See contract drafter messages (green badge)</li>
          <li>‚úì Download agreement template</li>
          <li>‚úì Upload signed contract</li>
          <li>‚úì Respond with questions or comments</li>
        </ul>
      </div>
    </div>

    <div class="section">
      <h2><span class="icon">üóëÔ∏è</span> Cleanup</h2>
      <button class="danger" onclick="clearDemo()">Remove Demo Data</button>
      <p style="color: #6b7280; font-size: 14px; margin-top: 10px; text-align: center;">
        Click this when you're done testing to remove all demo data from localStorage
      </p>
    </div>
  </div>

  <script>
    const DEMO_SUBMISSION_ID = 'DEMO-CONTRACT-2024-001';

    function createDemo() {
      try {
        // Create demo submission
        const demoSubmission = {
          submissionId: DEMO_SUBMISSION_ID,
          submissionDate: new Date().toISOString(),
          submittedBy: 'sarah.johnson@nhs.net',
          status: 'contract_review',
          currentStage: 'contract',

          formData: {
            firstName: 'Sarah',
            lastName: 'Johnson',
            department: 'Cardiology',
            nhsEmail: 'sarah.johnson@nhs.net',
            companyName: 'Elite Consulting Ltd',
            contactName: 'John Smith',
            contactEmail: 'john.smith@eliteconsulting.com',
            contactPhone: '020 7123 4567',
            supplierType: 'sole_trader',
            soleTraderStatus: 'yes',
            overseasSupplier: 'no',
          },

          pbpReview: {
            decision: 'approved',
            comments: 'All documentation in order.',
            signature: 'Emma Williams',
            date: '2024-02-05',
            reviewedBy: 'Emma Williams',
            reviewedAt: '2024-02-05T10:30:00Z'
          },

          procurementReview: {
            decision: 'approved',
            supplierClassification: 'opw_ir35',
            comments: 'Routed to OPW Panel for IR35 assessment.',
            signature: 'Michael Chen',
            date: '2024-02-06',
            reviewedBy: 'Michael Chen',
            reviewedAt: '2024-02-06T14:15:00Z'
          },

          opwReview: {
            ir35Status: 'outside_ir35',
            rationale: 'Supplier operates as genuine business with multiple clients, substitution rights, and financial risk.',
            decision: 'approved',
            signature: 'David Thompson',
            date: '2024-02-07',
            reviewedBy: 'David Thompson',
            reviewedAt: '2024-02-07T16:45:00Z'
          },

          contractDrafter: {
            status: 'sent',
            decision: 'approved',
            ir35Status: 'outside_ir35',
            requiredTemplate: 'BartsConsultancyAgreement.1.2.docx',
            templateUsed: 'BartsConsultancyAgreement.1.2.docx',
            assignedTo: 'peter.persaud@nhs.net',
            decidedBy: 'Peter Persaud',
            decidedAt: '2024-02-09T10:00:00Z',
            digitalSignature: 'Peter Persaud',
            signedAt: '2024-02-09T10:00:00Z',
            lastUpdated: '2024-02-09T10:00:00Z',
            finalizedAgreement: {
              name: 'BartsConsultancyAgreement_Signed_Final.pdf',
              type: 'application/pdf',
              size: 1048576,
              base64: 'data:application/pdf;base64,JVBERi0xLjQKJeLjz9MKMSAwIG9iago8PAovVHlwZSAvQ2F0YWxvZwovUGFnZXMgMiAwIFIKPj4KZW5kb2JqCjIgMCBvYmoKPDwKL1R5cGUgL1BhZ2VzCi9LaWRzIFszIDAgUl0KL0NvdW50IDEKL01lZGlhQm94IFswIDAgNTk1LjI4IDg0MS44OV0KPj4KZW5kb2JqCjMgMCBvYmoKPDwKL1R5cGUgL1BhZ2UKL1BhcmVudCAyIDAgUgovQ29udGVudHMgNCAwIFIKPj4KZW5kb2JqCjQgMCBvYmoKPDwKL0xlbmd0aCA1MDYKL0ZpbHRlciAvRmxhdGVEZWNvZGUKPj4Kc3RyZWFtCnic',
              uploadedAt: '2024-02-09T09:55:00Z',
              uploadedBy: 'Peter Persaud'
            },
            exchanges: [
              {
                id: 'CNT-1707384600-abc12',
                type: 'contract_request',
                from: 'contract_drafter',
                fromName: 'Peter Persaud',
                message: 'Dear John,\n\nFollowing the IR35 assessment, please review the attached Barts Consultancy Agreement.\n\nREQUIRED ACTIONS:\n1. Review all sections\n2. Complete Section 4 (Supplier Information)\n3. Sign on page 12\n4. Upload signed document\n\nRegards,\nPeter',
                attachments: [{
                  name: 'BartsConsultancyAgreement.1.2.docx',
                  type: 'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
                  url: '/templates/BartsConsultancyAgreement.1.2.docx',
                  isTemplate: true
                }],
                timestamp: '2024-02-08T09:30:00Z'
              },
              {
                id: 'CNT-1707398400-xyz89',
                type: 'supplier_response',
                from: 'supplier',
                fromName: 'John Smith',
                message: 'Hi Peter,\n\nQuestion about clause 5.3 regarding IP rights. Also, daily rate should be ¬£850, not ¬£800.\n\nBest regards,\nJohn',
                attachments: [],
                timestamp: '2024-02-08T14:20:00Z'
              },
              {
                id: 'CNT-1707412800-def45',
                type: 'contract_drafter_response',
                from: 'contract_drafter',
                fromName: 'Peter Persaud',
                message: 'Hi John,\n\n1. Pre-existing IP remains yours per clause 5.3\n2. Confirmed - update rate to ¬£850\n\nBest regards,\nPeter',
                attachments: [],
                timestamp: '2024-02-08T16:00:00Z'
              },
              {
                id: 'CNT-1707426400-final',
                type: 'contract_approved',
                from: 'contract_drafter',
                fromName: 'Peter Persaud',
                message: 'Contract approved and ready for AP Control. All terms agreed.',
                decision: 'approved',
                timestamp: '2024-02-09T10:00:00Z'
              }
            ]
          }
        };

        // Save to localStorage
        localStorage.setItem(`submission_${DEMO_SUBMISSION_ID}`, JSON.stringify(demoSubmission));

        // Add to submissions list
        const submissions = JSON.parse(localStorage.getItem('all_submissions') || '[]');
        const existingIndex = submissions.findIndex(s => s.submissionId === DEMO_SUBMISSION_ID);

        const summaryEntry = {
          submissionId: DEMO_SUBMISSION_ID,
          companyName: 'Elite Consulting Ltd',
          submittedBy: 'sarah.johnson@nhs.net',
          submissionDate: demoSubmission.submissionDate,
          status: 'contract_review',
          currentStage: 'contract',
          ir35Status: 'outside_ir35'
        };

        if (existingIndex !== -1) {
          submissions[existingIndex] = summaryEntry;
        } else {
          submissions.push(summaryEntry);
        }

        localStorage.setItem('all_submissions', JSON.stringify(submissions));

        // Update UI
        const contractDrafterUrl = `${window.location.origin}/contract-drafter/${DEMO_SUBMISSION_ID}`;
        const responseUrl = `${window.location.origin}/respond/${DEMO_SUBMISSION_ID}`;

        document.getElementById('contractDrafterLink').href = contractDrafterUrl;
        document.getElementById('responseLink').href = responseUrl;
        document.getElementById('demoLinks').style.display = 'flex';
        document.getElementById('demoStatus').textContent = 'Ready';
        document.getElementById('demoStatus').classList.add('ready');

        showSuccess('‚úÖ Demo data created successfully! Click the links above to test the contract drafter workflow.');
      } catch (error) {
        showError('‚ùå Failed to create demo data: ' + error.message);
      }
    }

    function clearDemo() {
      try {
        localStorage.removeItem(`submission_${DEMO_SUBMISSION_ID}`);

        const submissions = JSON.parse(localStorage.getItem('all_submissions') || '[]');
        const filtered = submissions.filter(s => s.submissionId !== DEMO_SUBMISSION_ID);
        localStorage.setItem('all_submissions', JSON.stringify(filtered));

        document.getElementById('demoLinks').style.display = 'none';
        document.getElementById('demoStatus').textContent = 'Not Created';
        document.getElementById('demoStatus').classList.remove('ready');

        showSuccess('üóëÔ∏è Demo data removed successfully!');
      } catch (error) {
        showError('‚ùå Failed to remove demo data: ' + error.message);
      }
    }

    function showSuccess(message) {
      const el = document.getElementById('successMessage');
      el.textContent = message;
      el.classList.add('show');
      setTimeout(() => el.classList.remove('show'), 5000);
    }

    function showError(message) {
      const el = document.getElementById('errorMessage');
      el.textContent = message;
      el.classList.add('show');
      setTimeout(() => el.classList.remove('show'), 5000);
    }

    // Check if demo already exists on page load
    window.addEventListener('load', () => {
      const existing = localStorage.getItem(`submission_${DEMO_SUBMISSION_ID}`);
      if (existing) {
        const contractDrafterUrl = `${window.location.origin}/contract-drafter/${DEMO_SUBMISSION_ID}`;
        const responseUrl = `${window.location.origin}/respond/${DEMO_SUBMISSION_ID}`;

        document.getElementById('contractDrafterLink').href = contractDrafterUrl;
        document.getElementById('responseLink').href = responseUrl;
        document.getElementById('demoLinks').style.display = 'flex';
        document.getElementById('demoStatus').textContent = 'Ready';
        document.getElementById('demoStatus').classList.add('ready');
      }
    });
  </script>
</body>
</html>
